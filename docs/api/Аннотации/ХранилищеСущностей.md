# ХранилищеСущностей

Аннотация, помечающая класс как хранилище (репозиторий) сущностей, предоставляющий методы для работы с объектами определенного типа в базе данных.

## Синтаксис

```1c
&ХранилищеСущностей(ИмяТипаСущности [, ИсточникДанных])
Процедура ПриСозданииОбъекта()
КонецПроцедуры
```

## Параметры

### ИмяТипаСущности

**Тип:** `Строка`

Имя типа сущности, для которой создается хранилище. Должно соответствовать имени класса сущности.

### ИсточникДанных

**Тип:** `Строка` (опционально)

Имя источника данных, который будет использоваться для данной сущности. Если не указан, используется основной источник данных.

## Описание

Аннотация `&ХранилищеСущностей` превращает обычный класс в репозиторий для работы с сущностями определенного типа. Класс автоматически получает:

- Доступ к базовому хранилищу сущностей через поле `ХранилищеСущностей`
- Возможность определения методов с аннотацией `&МетодЗапроса`
- Интеграцию с контейнером зависимостей autumn

## Требования к классу

Класс, помеченный аннотацией `&ХранилищеСущностей`, должен:

1. Содержать поле `ХранилищеСущностей`, помеченное аннотацией `&Родитель`
2. Быть зарегистрированным в контейнере зависимостей autumn

## Структура класса

```1c
&Родитель
Перем ХранилищеСущностей;

// Автогенерируемые методы
&МетодЗапроса
Функция ПолучитьПоИдентификаторРавно(Идентификатор) Экспорт
    Возврат Неопределено;
КонецФункции

// Кастомные методы
Функция СоздатьСДефолтнымиЗначениями(Имя) Экспорт
    НовыйОбъект = Новый ТипСущности();
    НовыйОбъект.Имя = Имя;
    НовыйОбъект.ДатаСоздания = ТекущаяДата();
    НовыйОбъект.Активен = Истина;
    
    Возврат ХранилищеСущностей.Создать(НовыйОбъект);
КонецФункции

&ХранилищеСущностей("ТипСущности")
Процедура ПриСозданииОбъекта()
КонецПроцедуры
```

## Примеры

### Простое хранилище

```1c
&Родитель
Перем ХранилищеСущностей;

&МетодЗапроса
Функция НайтиПоИмениРавно(Имя) Экспорт
    Возврат Неопределено;
КонецФункции

&МетодЗапроса
Функция ПолучитьВсе() Экспорт
    Возврат Неопределено;
КонецФункции

&ХранилищеСущностей("Пользователь")
Процедура ПриСозданииОбъекта()
КонецПроцедуры
```

### Хранилище с указанием источника данных

```1c
&Родитель
Перем ХранилищеСущностей;

&МетодЗапроса
Функция НайтиПоНомеруРавно(Номер) Экспорт
    Возврат Неопределено;
КонецФункции

&ХранилищеСущностей("Документ", "Архивный")
Процедура ПриСозданииОбъекта()
КонецПроцедуры
```

### Хранилище с кастомной логикой

```1c
&Родитель
Перем ХранилищеСущностей;

&МетодЗапроса
Функция НайтиПоEmailРавно(Email) Экспорт
    Возврат Неопределено;
КонецФункции

Функция СоздатьПользователяСАвтогенерацией(Имя, Email) Экспорт
    // Проверяем уникальность email
    СуществующийПользователь = НайтиПоEmailРавно(Email);
    Если СуществующийПользователь <> Неопределено Тогда
        ВызватьИсключение "Пользователь с таким email уже существует";
    КонецЕсли;
    
    // Создаем нового пользователя
    НовыйПользователь = Новый Пользователь();
    НовыйПользователь.Имя = Имя;
    НовыйПользователь.Email = Email;
    НовыйПользователь.Идентификатор = Новый УникальныйИдентификатор();
    НовыйПользователь.ДатаСоздания = ТекущаяДата();
    НовыйПользователь.Активен = Истина;
    
    Возврат ХранилищеСущностей.Создать(НовыйПользователь);
КонецФункции

Функция ПолучитьСтатистикуПользователей() Экспорт
    ОбщееКоличество = ХранилищеСущностей.Количество();
    
    ОпцииАктивных = Новый ОпцииПоиска()
        .Отбор("Активен", ВидСравнения.Равно, Истина);
    КоличествоАктивных = ХранилищеСущностей.Количество(ОпцииАктивных);
    
    Статистика = Новый Структура();
    Статистика.Вставить("Общее", ОбщееКоличество);
    Статистика.Вставить("Активные", КоличествоАктивных);
    Статистика.Вставить("Неактивные", ОбщееКоличество - КоличествоАктивных);
    
    Возврат Статистика;
КонецФункции

&ХранилищеСущностей("Пользователь")
Процедура ПриСозданииОбъекта()
КонецПроцедуры
```

## Регистрация в контейнере

Хранилища автоматически регистрируются в контейнере зависимостей под именами:

- **Без указания источника данных:** `ХранилищеСущностей[ИмяТипаСущности]`
- **С указанием источника данных:** `ХранилищеСущности[ИсточникДанных][ИмяТипаСущности]`

Например:
```1c
// Для &ХранилищеСущностей("Пользователь")
ХранилищеПользователей = Поделка.НайтиЖелудь("ХранилищеСущностейПользователь");

// Для &ХранилищеСущностей("Документ", "Архивный")
ХранилищеДокументов = Поделка.НайтиЖелудь("ХранилищеСущностейАрхивныйДокумент");
```

## Доступные методы базового хранилища

Через поле `ХранилищеСущностей` доступны следующие методы:

- `Создать(Объект)` - создание нового объекта
- `Обновить(Объект)` - обновление существующего объекта
- `Удалить(Объект)` - удаление объекта
- `Получить(ОпцииПоиска)` - получение коллекции объектов
- `ПолучитьОдно(ОпцииПоиска)` - получение одного объекта
- `Количество(ОпцииПоиска)` - подсчет количества объектов
- `Существует(ОпцииПоиска)` - проверка существования объектов

## См. также

- [МетодЗапроса](МетодЗапроса.md)
- [ЗаготовкаОсеньДата](../Классы/ЗаготовкаОсеньДата.md)
- [Настройка источников данных](/docs/product/020-configuration.md)