---
title: Настройка источников данных
---

# Настройка источников данных

Библиотека `autumn-data` поддерживает работу с множественными источниками данных через конфигурацию в рамках autumn framework.

## Основные понятия

### Источник данных

Источник данных определяет подключение к конкретной базе данных. Каждый источник данных имеет:

- **Имя** - уникальный идентификатор источника
- **Тип коннектора** - класс коннектора для подключения к БД
- **Строку соединения** - параметры подключения к БД
- **Параметры коннектора** - дополнительные параметры

### Менеджер сущностей

Менеджер сущностей управляет моделью данных для конкретного источника данных и предоставляет хранилища сущностей.

## Конфигурация одного источника данных

### Как соответствие

```1c
СоветДругогоМастера = Новый СоветДругогоМастера()
    .Деталька("data.ИсточникиДанных", Новый Соответствие()
        .Вставить("ТипКоннектора", "КоннекторSqlite")
        .Вставить("СтрокаСоединения", "Data Source=database.db")
    );
```

При такой конфигурации создается источник данных без имени, и все хранилища будут использовать его по умолчанию.

### Как массив с одним элементом

```1c
СоветДругогоМастера = Новый СоветДругогоМастера()
    .Деталька("data.ИсточникиДанных", Новый Массив()
        .Добавить(Новый Соответствие()
            .Вставить("Имя", "Основной")
            .Вставить("ТипКоннектора", "КоннекторSqlite")
            .Вставить("СтрокаСоединения", "Data Source=database.db")
        )
    );
```

## Конфигурация множественных источников данных

```1c
СоветДругогоМастера = Новый СоветДругогоМастера()
    .Деталька("data.ИсточникиДанных", Новый Массив()
        .Добавить(Новый Соответствие()
            .Вставить("Имя", "Основной")
            .Вставить("ТипКоннектора", "КоннекторSqlite")
            .Вставить("СтрокаСоединения", "Data Source=main.db")
        )
        .Добавить(Новый Соответствие()
            .Вставить("Имя", "Дополнительный")
            .Вставить("ТипКоннектора", "КоннекторPostgreSQL")
            .Вставить("СтрокаСоединения", "Host=localhost;Database=testdb;Username=user;Password=pass")
        )
    );
```

## Указание источника данных для сущности

По умолчанию сущности используют основной источник данных. Для указания конкретного источника используйте параметр `ИсточникДанных` в аннотации `&Сущность`:

```1c
// Использует основной источник данных
&Сущность(ИмяТаблицы = "Пользователи")
Процедура ПриСозданииОбъекта()
КонецПроцедуры

// Использует дополнительный источник данных
&Сущность(ИмяТаблицы = "Документы", ИсточникДанных = "Дополнительный")
Процедура ПриСозданииОбъекта()
КонецПроцедуры
```

## Указание источника данных для хранилища

Аналогично для хранилищ сущностей:

```1c
// Хранилище для основного источника данных
&ХранилищеСущностей("Пользователь")
Процедура ПриСозданииОбъекта()
КонецПроцедуры

// Хранилище для дополнительного источника данных
&ХранилищеСущностей("Документ", "Дополнительный")
Процедура ПриСозданииОбъекта()
КонецПроцедуры
```

## Получение хранилищ из контейнера

При использовании множественных источников данных хранилища регистрируются в контейнере с составными именами:

```1c
// Для основного источника
ХранилищеПользователей = Поделка.НайтиЖелудь("ХранилищеСущностейОсновнойПользователь");

// Для дополнительного источника  
ХранилищеДокументов = Поделка.НайтиЖелудь("ХранилищеСущностейДополнительныйДокумент");

// Также можно использовать прозвища
ХранилищеПользователей = Поделка.НайтиЖелудь("ХранилищеСущностейОсновной");
ХранилищеДокументов = Поделка.НайтиЖелудь("ХранилищеСущностейДополнительный");
```

## Поддерживаемые типы коннекторов

Библиотека поддерживает все коннекторы из библиотеки `entity`:

- `КоннекторSqlite`
- `КоннекторPostgreSQL`
- `КоннекторMySQL`
- `КоннекторInMemory` (для тестирования)
- И другие коннекторы, поддерживаемые entity

## Параметры коннектора

Некоторые коннекторы могут требовать дополнительные параметры, которые передаются через массив `ПараметрыКоннектора`:

```1c
СоветДругогоМастера = Новый СоветДругогоМастера()
    .Деталька("data.ИсточникиДанных", Новый Соответствие()
        .Вставить("ТипКоннектора", "КоннекторPostgreSQL")
        .Вставить("СтрокаСоединения", "Host=localhost;Database=testdb")
        .Вставить("ПараметрыКоннектора", Новый Массив()
            .Добавить("дополнительный_параметр")
        )
    );
```